<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DexScreens API Tester</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            border: 2px solid #00ff00;
            padding: 20px;
        }
        .controls {
            background: #2a2a2a;
            border: 1px solid #00ff00;
            padding: 20px;
            margin-bottom: 20px;
        }
        .controls input, .controls button {
            background: #1a1a1a;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 10px;
            margin: 5px;
            font-family: inherit;
        }
        .controls button {
            cursor: pointer;
        }
        .controls button:hover {
            background: #00ff00;
            color: #1a1a1a;
        }
        .output {
            background: #000;
            border: 1px solid #00ff00;
            padding: 20px;
            min-height: 400px;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 600px;
        }
        .loading {
            color: #ffff00;
        }
        .error {
            color: #ff0000;
        }
        .success {
            color: #00ff00;
        }
        .info {
            color: #00aaff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 DexScreens API Tester</h1>
            <p>Test DexScreens API with combined volume from all bundles</p>
        </div>

        <div class="controls">
            <h3>Configuration</h3>
            <div>
                <label>Token Address:</label><br>
                <input type="text" id="tokenAddress" value="FfTMftfnF64keWwxiREcSBca2PsQtkorb2LWCEdZpump" style="width: 400px;">
            </div>
            <div>
                <label>Start Date (ISO format):</label><br>
                <input type="text" id="startDate" value="2024-01-01T00:00:00Z" style="width: 200px;">
            </div>
            <div>
                <label>Dollars per Second:</label><br>
                <input type="number" id="dollarsPerSecond" value="10" style="width: 100px;">
            </div>
            <div style="margin-top: 15px;">
                <button onclick="fetchData()">🔄 Fetch DexScreens Data</button>
                <button onclick="clearOutput()">🗑️ Clear Output</button>
                <button onclick="copyToClipboard()">📋 Copy Results</button>
            </div>
        </div>

        <div class="output" id="output">
Click "Fetch DexScreens Data" to start...
        </div>
    </div>

    <script>
        let lastResult = null;

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            
            const line = `[${timestamp}] ${message}\n`;
            output.innerHTML += `<span class="${className}">${line}</span>`;
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        function copyToClipboard() {
            if (lastResult) {
                navigator.clipboard.writeText(JSON.stringify(lastResult, null, 2))
                    .then(() => log('✅ Results copied to clipboard!', 'success'))
                    .catch(() => log('❌ Failed to copy to clipboard', 'error'));
            } else {
                log('❌ No results to copy', 'error');
            }
        }

        async function fetchData() {
            const tokenAddress = document.getElementById('tokenAddress').value.trim();
            const startDate = document.getElementById('startDate').value.trim();
            const dollarsPerSecond = parseInt(document.getElementById('dollarsPerSecond').value) || 10;

            if (!tokenAddress) {
                log('❌ Please enter a token address', 'error');
                return;
            }

            clearOutput();
            log('🚀 Starting DexScreens API fetch...', 'loading');
            log(`📅 Start Date: ${startDate}`, 'info');
            log(`🪙 Token Address: ${tokenAddress}`, 'info');
            log(`💰 Volume Rate: $${dollarsPerSecond} = 1 second`, 'info');
            log('─'.repeat(60), 'info');

            try {
                const response = await fetch(`https://api.dexscreener.com/latest/dex/tokens/${tokenAddress}`);
                
                if (!response.ok) {
                    throw new Error(`DexScreens API error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                
                if (!data.pairs || !Array.isArray(data.pairs) || data.pairs.length === 0) {
                    throw new Error("No pairs found for this token");
                }

                log(`📊 Found ${data.pairs.length} pair(s)/bundle(s):`, 'success');
                log('─'.repeat(60), 'info');

                // Process all pairs and calculate combined volume
                let totalVolume24h = 0;
                let totalLiquidity = 0;
                let bestPrice = 0;
                let bestMarketCap = 0;
                let totalSupply = 0;

                data.pairs.forEach((pair, index) => {
                    const volume24h = parseFloat(pair?.volume?.h24 || "0") || 0;
                    const liquidity = parseFloat(pair?.liquidity?.usd || "0") || 0;
                    const price = parseFloat(pair?.priceUsd || "0") || 0;
                    const marketCap = parseFloat(pair?.marketCap || "0") || 0;
                    const supply = parseFloat(pair?.totalSupply || "0") || 0;

                    totalVolume24h += volume24h;
                    totalLiquidity += liquidity;

                    if (price > bestPrice) bestPrice = price;
                    if (marketCap > bestMarketCap) bestMarketCap = marketCap;
                    if (supply > totalSupply) totalSupply = supply;

                    log(`Bundle ${index + 1}:`, 'info');
                    log(`  📈 DEX: ${pair?.dexId || 'Unknown'}`, 'info');
                    log(`  💧 Liquidity: $${liquidity.toLocaleString()}`, 'info');
                    log(`  📊 24h Volume: $${volume24h.toLocaleString()}`, 'info');
                    log(`  💲 Price: $${price}`, 'info');
                    log(`  🏪 Pair: ${pair?.baseToken?.symbol || '?'}/${pair?.quoteToken?.symbol || '?'}`, 'info');
                    log(`  🔗 URL: ${pair?.url || 'N/A'}`, 'info');
                    log('', 'info');
                });

                // Calculate time tracking
                const startDateObj = new Date(startDate);
                const currentDate = new Date();
                const timeElapsedMs = currentDate.getTime() - startDateObj.getTime();
                const timeElapsedSeconds = Math.floor(timeElapsedMs / 1000);
                const timeElapsedMinutes = Math.floor(timeElapsedSeconds / 60);
                const timeElapsedHours = Math.floor(timeElapsedMinutes / 60);
                const timeElapsedDays = Math.floor(timeElapsedHours / 24);

                const timeBonusSeconds = Math.floor(totalVolume24h / dollarsPerSecond);
                const timeBonusMinutes = Math.floor(timeBonusSeconds / 60);
                const timeBonusHours = Math.floor(timeBonusMinutes / 60);

                // Display results
                log('🎯 COMBINED RESULTS:', 'success');
                log('═'.repeat(60), 'success');
                log(`💰 Total 24h Volume (All Bundles): $${totalVolume24h.toLocaleString()}`, 'success');
                log(`💧 Total Liquidity: $${totalLiquidity.toLocaleString()}`, 'success');
                log(`💲 Best Price: $${bestPrice}`, 'success');
                log(`📊 Best Market Cap: $${bestMarketCap.toLocaleString()}`, 'success');
                log(`🪙 Total Supply: ${totalSupply.toLocaleString()}`, 'success');
                log('', 'info');
                
                log('⏰ TIME TRACKING:', 'success');
                log('─'.repeat(40), 'success');
                log(`📅 Start Date: ${startDateObj.toLocaleString()}`, 'success');
                log(`📅 Current Date: ${currentDate.toLocaleString()}`, 'success');
                log(`⏱️  Time Elapsed: ${timeElapsedDays}d ${timeElapsedHours % 24}h ${timeElapsedMinutes % 60}m ${timeElapsedSeconds % 60}s`, 'success');
                log('', 'info');
                
                log('🎁 VOLUME BONUS:', 'success');
                log('─'.repeat(40), 'success');
                log(`⚡ Time Bonus: ${timeBonusSeconds} seconds (${timeBonusMinutes}m ${timeBonusSeconds % 60}s)`, 'success');
                log(`📈 Bonus Hours: ${timeBonusHours}h ${timeBonusMinutes % 60}m`, 'success');
                log(`💡 Rate: $${dollarsPerSecond} = 1 second`, 'success');

                // Store result for copying
                lastResult = {
                    tokenAddress,
                    startDate,
                    currentDate: currentDate.toISOString(),
                    timeElapsed: {
                        totalSeconds: timeElapsedSeconds,
                        days: timeElapsedDays,
                        hours: timeElapsedHours % 24,
                        minutes: timeElapsedMinutes % 60,
                        seconds: timeElapsedSeconds % 60
                    },
                    volume: {
                        total24hUsd: totalVolume24h,
                        totalLiquidityUsd: totalLiquidity,
                        timeBonusSeconds: timeBonusSeconds,
                        timeBonusMinutes: timeBonusMinutes,
                        timeBonusHours: timeBonusHours
                    },
                    token: {
                        priceUsd: bestPrice,
                        marketCapUsd: bestMarketCap,
                        totalSupply: totalSupply
                    },
                    pairs: data.pairs.map(pair => ({
                        dexId: pair?.dexId,
                        volume24hUsd: parseFloat(pair?.volume?.h24 || "0") || 0,
                        liquidityUsd: parseFloat(pair?.liquidity?.usd || "0") || 0,
                        priceUsd: parseFloat(pair?.priceUsd || "0") || 0,
                        url: pair?.url,
                        baseSymbol: pair?.baseToken?.symbol,
                        quoteSymbol: pair?.quoteToken?.symbol
                    }))
                };

                log('✅ Fetch completed successfully!', 'success');

            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
                console.error('DexScreens API Error:', error);
            }
        }

        // Auto-focus on load
        window.onload = () => {
            log('🎯 DexScreens API Tester Ready!', 'success');
            log('📋 Configure your settings above and click "Fetch DexScreens Data"', 'info');
        };
    </script>
</body>
</html>
